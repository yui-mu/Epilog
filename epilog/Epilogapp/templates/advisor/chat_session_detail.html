{% extends "advisor/advisor_base.html" %}

{% block content %}
<h2>{{ session.user.username }} さんとのチャット</h2>

<div class="chat-box">
    {% for msg in messages %}
      <div style="margin-bottom: 10px; text-align: {% if msg.sender == request.user %}right{% else %}left{% endif %};">
        <div style="display: inline-block; padding: 8px 12px; background-color: {% if msg.sender == request.user %}#d1f0ff{% else %}#f0f0f0{% endif %}; border-radius: 10px; max-width: 70%;">
          <strong>{{ msg.sender.username }}:</strong> {{ msg.content }}
        </div>
      </div>
    {% empty %}
      <p>まだメッセージがありません。</p>
    {% endfor %}
</div>
  
<form method="post" style="margin-top: 20px;">
    {% csrf_token %}
    <textarea name="content" rows="3" cols="60" placeholder="メッセージを入力..." style="margin-bottom: 5px;"></textarea><br>
    <button type="submit">送信</button>
</form>
  
<form method="post" action="{% url 'chat_session_complete' session.id %}" style="margin-top: 10px;">
    {% csrf_token %}
    <button type="submit">チャットを終了する</button>
</form>
  
<a href="{% url 'advisor_active_chats' %}">← 一覧に戻る</a>
{% endblock %}
