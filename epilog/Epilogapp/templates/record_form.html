{% extends 'base.html' %}
{% block content %}

<style>
  .record-container {
    max-width: 1000px;
    margin: 40px auto;
    padding: 30px 20px;
    background-color: #ffffff;
    border-radius: 12px;
  }

  .page-title {
    text-align: center;
    font-size: 24px;
    margin-bottom: 30px;
  }

  .form-group,
  .photo-section,
  .concern-block,
  .form-actions {
    margin-bottom: 30px;
  }

  .care-sections {
    display: flex;
    gap: 40px;
    justify-content: space-between;
    margin-top: 30px;
  }

  .care-block {
    flex: 1;
    background-color: #f5f9f6;
    padding: 20px;
    border: 1px solid #a7d7c5;
    border-radius: 12px;
  }

  .care-block h3 {
    text-align: center;
    margin-bottom: 20px;
    font-size: 18px;
  }

  .item-row {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
    margin-bottom: 12px;
  }
  
  .row-header {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .item-label {
    font-weight: bold;
    white-space: nowrap;
    margin: 0;
    padding: 0;
    line-height: 1;
    display: flex;
    align-items: center; 
    margin-top: 15px;
  }
  
  
  .item-row input {
    width: 100%;
    padding: 6px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-bottom: 4px;
  }

  .item-row select {
    width: 100%;
    padding: 6px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-bottom: 4px;
  }
  

  label {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
  }

  .condition-icons {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 10px;
  }

  .face-label span {
    display: block;
    text-align: center;
    font-size: 14px;
  }

  .form-actions {
    text-align: center;
  }

  button {
    background-color: #a7d7c5;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 20px;
  }

  .remove-btn {
    background-color: #eee;
    color: #333;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    width: 26px;
    height: 26px;
    padding: 0;
    line-height: 1;
    margin-right: 8px;
    cursor: pointer;
    vertical-align: middle;
  }
  

  a {
    text-align: center;
    display: block;
    margin-top: 20px;
  }

  .condition-icons {
    display: flex;
    justify-content: center;
    gap: 25px;
    margin-top: 10px;
  }

  .skin-rating-option {
    width: 70px;
    text-align: center;
    padding: 8px;
    cursor: pointer;
    display: inline-block;
  }


  .skin-rating-option .icon {
    font-size: 32px;
    line-height: 1;
    display: block;
    text-align: center;
  }

  .skin-rating-option.selected {
    border: 2px solid #3ba58b;
    background-color: #e0f4ef;
    border-radius: 8px;
  }

  .skin-rating-option input[type="radio"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }
  

  .skin-rating-option .label-text {
    margin-top: 5px;
    font-size: 14px;
  }

  .skin-rating-widget {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-top: 10px;
  }

  .photo-section {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 40px;
    margin-bottom: 30px;
  }
  
  .photo-section .left-block,
  .photo-section .right-block {
    flex: 1;
  }
  
  #preview-button {
    margin-top: 10px;
  }

  #id_skin_condition {
    display: block;
    margin: 0 auto;          
    width: 90%;              
    max-width: 800px;
    height: 80px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
    resize: vertical;
  }
  
  #add-morning-item,
  #add-night-item {
    background-color: #a7d7c5;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
  }


</style>


<div class="record-container">
  <h1 class="page-title" style="text-align:center;">ã‚¹ã‚­ãƒ³ã‚±ã‚¢è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ </h1>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {% if form.errors %}
      <div style="background-color: #fce4e4; border: 1px solid #f5c2c2; color: #c72c2c;
              padding: 10px; margin: 15px auto; max-width: 600px; border-radius: 6px;">
        <ul>
          {% for field in form %}
            {% for error in field.errors %}
              <li>{{ field.label }}: {{ error }}</li>
            {% endfor %}
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <!-- è‚Œã®å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
    <div class="photo-section">
      <div class="left-block">
        <label>{{ form.record_date.label }}</label><br>
        {{ form.record_date }}
      </div>
      <div class="right-block">
        <label>{{ form.photo.label }}</label><br>
        {{ form.photo }}<br>
        <button type="button" id="preview-button">ç¾åœ¨ã®è‚Œã®å†™çœŸã‚’ç™»éŒ²</button>
        <div id="photo-preview" style="margin-top: 10px;">
          <img id="preview-image" src="#" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ"
               style="max-width: 250px; display: none; border-radius: 8px;">
        </div>
      </div>
    </div>
    
    <!-- âœ… è‚Œã®èª¿å­ï¼šé¡”ã‚¢ã‚¤ã‚³ãƒ³é¸æŠå‡¦ç† -->
    <div class="form-group">
      <strong>{{ form.skin_rating.label }}</strong>
      <div class="skin-rating-widget">
        {% for radio in form.skin_rating %}
          {% if radio.choice_label != '---------' %}
            {{ radio.tag }}
            <label for="{{ radio.id_for_label }}">
              <span class="icon">
                {% if radio.choice_label == "ã¨ã¦ã‚‚è‰¯ã„" %} ğŸ˜„
                {% elif radio.choice_label == "è‰¯ã„" %} ğŸ™‚
                {% elif radio.choice_label == "æ™®é€š" %} ğŸ˜
                {% elif radio.choice_label == "ã‚„ã‚„æ‚ªã„" %} ğŸ˜•
                {% elif radio.choice_label == "æ‚ªã„" %} ğŸ˜£
                {% endif %}
              </span>
              <span class="label-text">{{ radio.choice_label }}</span>
            </label>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- è‚Œã®çŠ¶æ…‹ãƒ¡ãƒ¢ -->
    <p>
      {{ form.skin_condition.label_tag }}<br>
      {{ form.skin_condition }}
    </p>

    <!-- æœãƒ»å¤œã®ã‚¹ã‚­ãƒ³ã‚±ã‚¢ -->
    <div class="care-sections">

      <!-- æœ -->
      <div class="care-block" id="morning-block">
        <strong>ğŸŒ æœã«ä½¿ã£ãŸã‚¢ã‚¤ãƒ†ãƒ </strong>
        <div id="morning-inputs">
          {% for i in "123456" %}
            <div class="item-row">
              <div class="row-header">
                <button type="button" class="remove-btn">ï¼</button>
                <label class="item-label">{{ forloop.counter }}ç•ªç›®ï¼š</label>
              </div>
              <select class="morning-select-type">
                <option value="">ç¨®é¡ã‚’é¸æŠ</option>
                <option value="ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°">ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°</option>
                <option value="æ´—é¡”">æ´—é¡”</option>
                <option value="å°å…¥ç¾å®¹æ¶²">å°å…¥ç¾å®¹æ¶²</option>
                <option value="åŒ–ç²§æ°´">åŒ–ç²§æ°´</option>
                <option value="ä¹³æ¶²">ä¹³æ¶²</option>
                <option value="ç¾å®¹æ¶²">ç¾å®¹æ¶²</option>
                <option value="ã‚¯ãƒªãƒ¼ãƒ ">ã‚¯ãƒªãƒ¼ãƒ </option>
                <option value="ãƒ‘ãƒƒã‚¯">ãƒ‘ãƒƒã‚¯</option>
                <option value="ãã®ä»–">ãã®ä»–</option>
              </select>
              <input type="text" class="morning-input-name" placeholder="å•†å“å / æˆåˆ†ï¼ˆä»»æ„ï¼‰">
            </div>
          {% endfor %}
        </div>        
        <button type="button" id="add-morning-item">ï¼‹é …ç›®ã‚’è¿½åŠ ã™ã‚‹</button>
        
      </div>
    
      <!-- å¤œ -->
      <div class="care-block" id="night-block">
        <strong>ğŸŒ™ å¤œã«ä½¿ã£ãŸã‚¢ã‚¤ãƒ†ãƒ </strong>
        <div id="night-inputs">
          {% for i in "123456" %}
            <div class="item-row">
              <div class="row-header">
                <button type="button" class="remove-btn">ï¼</button>
                <label class="item-label">{{ forloop.counter }}ç•ªç›®ï¼š</label>
              </div>
              <select class="night-select-type">
                <option value="">ç¨®é¡ã‚’é¸æŠ</option>
                <option value="ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°">ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°</option>
                <option value="æ´—é¡”">æ´—é¡”</option>
                <option value="å°å…¥ç¾å®¹æ¶²">å°å…¥ç¾å®¹æ¶²</option>
                <option value="åŒ–ç²§æ°´">åŒ–ç²§æ°´</option>
                <option value="ä¹³æ¶²">ä¹³æ¶²</option>
                <option value="ç¾å®¹æ¶²">ç¾å®¹æ¶²</option>
                <option value="ã‚¯ãƒªãƒ¼ãƒ ">ã‚¯ãƒªãƒ¼ãƒ </option>
                <option value="ãƒ‘ãƒƒã‚¯">ãƒ‘ãƒƒã‚¯</option>
                <option value="ãã®ä»–">ãã®ä»–</option>
              </select>
              <input type="text" class="night-input-name" placeholder="å•†å“å / æˆåˆ†ï¼ˆä»»æ„ï¼‰">
            </div>
          {% endfor %}
        </div>
        <button type="button" id="add-night-item">ï¼‹é …ç›®ã‚’è¿½åŠ ã™ã‚‹</button>
        
      </div>
    </div>

    <input type="hidden" name="morning_items" id="id_morning_items" value="{{ form.initial.morning_items|default:''|escape }}">
    <input type="hidden" name="night_items" id="id_night_items" value="{{ form.initial.night_items|default:''|escape }}">
    <input type="hidden" name="ingredients" id="id_ingredients" value="{{ form.initial.ingredients|default:''|escape }}">


    <!-- ç™»éŒ²ãƒœã‚¿ãƒ³ -->
    <div class="form-actions">
      <button type="submit">è¨˜éŒ²ã™ã‚‹</button>
    </div>
  </form>
</div>

<!-- å…¥åŠ›å†…å®¹ã‚’ã¾ã¨ã‚ã¦ä¿å­˜ã™ã‚‹JS -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
  
    // âœ… è‚Œã®èª¿å­ï¼šé¡”ã‚¢ã‚¤ã‚³ãƒ³é¸æŠå‡¦ç†
    const options = document.querySelectorAll('.skin-rating-option');
    options.forEach(option => {
      option.addEventListener('click', function () {
        const radio = this.querySelector('input[type="radio"]');
        if (radio && !radio.checked) {
          options.forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          radio.checked = true;
          const event = new Event('change', { bubbles: true });
          radio.dispatchEvent(event);
        }
      });
    });
  
    const selectedRating = document.querySelector('.skin-rating-option input[type="radio"]:checked');
    if (selectedRating) {
      selectedRating.closest('.skin-rating-option').classList.add('selected');
    }
  
    // âœ… è‚Œã®å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
    const previewButton = document.getElementById("preview-button");
    const photoInput = document.getElementById("id_photo");
    const previewImage = document.getElementById("preview-image");
    if (previewButton) {
      previewButton.addEventListener("click", function () {
        const file = photoInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            previewImage.src = e.target.result;
            previewImage.style.display = "block";
          };
          reader.readAsDataURL(file);
        } else {
          alert("ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        }
      });
    }

    function extractItemsFromCsv(csvStr, maxItems) {
      const items = csvStr.split(',')
        .map(s => s.trim())
        .filter(Boolean)
        .filter(s => s.split(':').length >= 2); 
      return items.slice(0, maxItems);
    }
    
    const morningRaw = "{{ form.morning_items.value|escapejs }}";
    console.log("morningRaw:", morningRaw);
    const nightRaw = "{{ form.night_items.value|escapejs }}";
    
    const morningCsv = extractItemsFromCsv(morningRaw, 6).join(',');
    const nightCsv = extractItemsFromCsv(nightRaw, 6).join(',');
    
    // âœ… åˆæœŸåŒ–å‘¼ã³å‡ºã—ï¼ˆ6ä»¶ã¾ã§ï¼‰
    //populateSimpleInputs("{{ form.morning_items.value|escapejs }}", "morning-inputs", "morning-input-name", 6);
    //populateSimpleInputs("{{ form.night_items.value|escapejs }}", "night-inputs", "night-input-name", 6);

    
  
    // âœ… ç·¨é›†æ™‚ã®åˆæœŸå•†å“åã®è¡¨ç¤ºï¼ˆæœãƒ»å¤œï¼‰1ï½6ä»¶ç›®ã¾ã§è¡¨ç¤º
    function populateSimpleInputs(csvStr, sectionId, inputClass, maxInitial = 6) {
      const items = csvStr.split(',').map(s => s.trim()).filter(Boolean);
      const container = document.getElementById(sectionId);
      container.innerHTML = "";

      items.forEach((item, index) => {
        if (!item) return;

        const parts = item.split(':');
        let category = '';
        let name = '';
        let ingredient = '';

        if (parts.length === 3) {
          [category, name, ingredient] = parts;
        } else if (parts.length === 2) {
          [category, name] = parts;
        } else {
          name = parts[0];  // â† å•†å“åã ã‘ã®å ´åˆã«ã‚‚å¯¾å¿œï¼
        }

        if (name === "None") {
          name = "";
        }
        
        if (index >= maxInitial) return;  // âœ… 7ä»¶ç›®ä»¥é™ã¯éè¡¨ç¤º

        const div = document.createElement("div");
        div.className = "item-row";
        div.innerHTML = `
          <div class="row-header">
            <button type="button" class="remove-btn">ï¼</button>
            <label class="item-label">${index + 1}ç•ªç›®ï¼š</label>
          </div>
          <select class="${inputClass}-select-type">
            <option value="">ç¨®é¡ã‚’é¸æŠ</option>
            <option value="ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°" ${category === "ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°" ? "selected" : ""}>ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°</option>
            <option value="æ´—é¡”" ${category === "æ´—é¡”" ? "selected" : ""}>æ´—é¡”</option>
            <option value="å°å…¥ç¾å®¹æ¶²" ${category === "å°å…¥ç¾å®¹æ¶²" ? "selected" : ""}>å°å…¥ç¾å®¹æ¶²</option>
            <option value="åŒ–ç²§æ°´" ${category === "åŒ–ç²§æ°´" ? "selected" : ""}>åŒ–ç²§æ°´</option>
            <option value="ä¹³æ¶²" ${category === "ä¹³æ¶²" ? "selected" : ""}>ä¹³æ¶²</option>
            <option value="ç¾å®¹æ¶²" ${category === "ç¾å®¹æ¶²" ? "selected" : ""}>ç¾å®¹æ¶²</option>
            <option value="ã‚¯ãƒªãƒ¼ãƒ " ${category === "ã‚¯ãƒªãƒ¼ãƒ " ? "selected" : ""}>ã‚¯ãƒªãƒ¼ãƒ </option>
            <option value="ãƒ‘ãƒƒã‚¯" ${category === "ãƒ‘ãƒƒã‚¯" ? "selected" : ""}>ãƒ‘ãƒƒã‚¯</option>
            <option value="ãã®ä»–" ${category === "ãã®ä»–" ? "selected" : ""}>ãã®ä»–</option>
          </select>
          <input type="text" class="${inputClass}" value="${name}" placeholder="å•†å“å / æˆåˆ†ï¼ˆä»»æ„ï¼‰">
        `;
        container.appendChild(div);
      });

      updateListeners();
      renumberItems(`#${sectionId}`);
    }

    // âœ… å‘¼ã³å‡ºã—ï¼ˆåˆæœŸè¡¨ç¤º6ä»¶ã¾ã§ï¼‰
    populateSimpleInputs("{{ form.morning_items.value|escapejs }}", "morning-inputs", "morning-input-name", 6);
    populateSimpleInputs("{{ form.night_items.value|escapejs }}", "night-inputs", "night-input-name", 6);

    // âœ… æœã®è¿½åŠ å‡¦ç†ï¼ˆ6ä»¶ç›®ä»¥é™ï¼‰
    const morningInputs = document.getElementById("morning-inputs");
    const addMorningBtn = document.getElementById("add-morning-item");
    if (addMorningBtn) {
      addMorningBtn.addEventListener("click", function () {
        const currentRows = morningInputs.querySelectorAll('.item-row').length;
        if (currentRows >= 10) {
          alert("æœã¯æœ€å¤§10ä»¶ã¾ã§è¿½åŠ ã§ãã¾ã™ã€‚");
          return;
        }
        const div = document.createElement("div");
        div.className = "item-row";
        div.innerHTML = `
          <button type="button" class="remove-btn">ï¼</button>
          <label>ç•ªç›®ï¼š</label>
          <select class="morning-select-type">
            <option value="">ç¨®é¡ã‚’é¸æŠ</option>
            <option value="ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°">ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°</option>
            <option value="æ´—é¡”">æ´—é¡”</option>
            <option value="å°å…¥ç¾å®¹æ¶²">å°å…¥ç¾å®¹æ¶²</option>
            <option value="åŒ–ç²§æ°´">åŒ–ç²§æ°´</option>
            <option value="ä¹³æ¶²">ä¹³æ¶²</option>
            <option value="ç¾å®¹æ¶²">ç¾å®¹æ¶²</option>
            <option value="ã‚¯ãƒªãƒ¼ãƒ ">ã‚¯ãƒªãƒ¼ãƒ </option>
            <option value="ãƒ‘ãƒƒã‚¯">ãƒ‘ãƒƒã‚¯</option>
            <option value="ãã®ä»–">ãã®ä»–</option>
          </select>
          <input type="text" class="morning-input-name" placeholder="å•†å“å / æˆåˆ†ï¼ˆä»»æ„ï¼‰">
        `;
        morningInputs.appendChild(div);
        updateListeners();
        renumberItems('#morning-inputs');
        bindInputEvents();
      });
    }

    // âœ… å¤œã®è¿½åŠ å‡¦ç†ï¼ˆ6ä»¶ç›®ä»¥é™ï¼‰
    const nightInputs = document.getElementById("night-inputs");
    const addNightBtn = document.getElementById("add-night-item");
    if (addNightBtn) {
      addNightBtn.addEventListener("click", function () {
        const currentRows = nightInputs.querySelectorAll('.item-row').length;
        if (currentRows >= 10) {
          alert("å¤œã¯æœ€å¤§10ä»¶ã¾ã§è¿½åŠ ã§ãã¾ã™ã€‚");
          return;
        }
        const div = document.createElement("div");
        div.className = "item-row";
        div.innerHTML = `
          <button type="button" class="remove-btn">ï¼</button>
          <label>ç•ªç›®ï¼š</label>
          <select class="night-select-type">
            <option value="">ç¨®é¡ã‚’é¸æŠ</option>
            <option value="ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°">ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°</option>
            <option value="æ´—é¡”">æ´—é¡”</option>
            <option value="å°å…¥ç¾å®¹æ¶²">å°å…¥ç¾å®¹æ¶²</option>
            <option value="åŒ–ç²§æ°´">åŒ–ç²§æ°´</option>
            <option value="ä¹³æ¶²">ä¹³æ¶²</option>
            <option value="ç¾å®¹æ¶²">ç¾å®¹æ¶²</option>
            <option value="ã‚¯ãƒªãƒ¼ãƒ ">ã‚¯ãƒªãƒ¼ãƒ </option>
            <option value="ãƒ‘ãƒƒã‚¯">ãƒ‘ãƒƒã‚¯</option>
            <option value="ãã®ä»–">ãã®ä»–</option>
          </select>
          <input type="text" class="night-input-name" placeholder="å•†å“å / æˆåˆ†ï¼ˆä»»æ„ï¼‰">
        `;
        nightInputs.appendChild(div);
        updateListeners();
        renumberItems('#night-inputs');
        bindInputEvents();
      });
    }

    // âœ… å‰Šé™¤ãƒ»ç•ªå·æ›´æ–°å‡¦ç†
    function updateListeners() {
      document.querySelectorAll('.remove-btn').forEach(btn => {
        btn.onclick = () => {
          const row = btn.closest('.item-row');
          if (row) row.remove();
          renumberItems('#morning-inputs');
          renumberItems('#night-inputs');
        };
      });
    }

    function renumberItems(parentSelector) {
      const container = document.querySelector(parentSelector);
      if (!container) return;
      const rows = container.querySelectorAll('.item-row');
      rows.forEach((row, index) => {
        const label = row.querySelector('label');
        if (label) label.textContent = `${index + 1}ç•ªç›®ï¼š`;
      });
    }

  
    // âœ… hiddenã«åæ˜ ï¼ˆä¿å­˜ç”¨ï¼‰
    function updateSimpleInputs(parentSelector, prefix, targetId) {
      const rows = document.querySelectorAll(`${parentSelector} .item-row`);
      const items = Array.from(rows).map(row => {
        const category = row.querySelector(`.${prefix}-select-type`)?.value.trim() || '';
        const name = row.querySelector(`.${prefix}-input-name`)?.value.trim() || '';
        const ingredient = row.querySelector(`.${prefix}-input-ingredient`)?.value.trim() || '';
        return `${category}:${name}:${ingredient}`;
      }).filter(item => item !== '::');
      const hiddenInput = document.getElementById(targetId);
      if (hiddenInput) hiddenInput.value = items.join(', ');
    }
    
    
    // âœ… å…¥åŠ›æ¬„ã®å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ â†’ hidden ã«åæ˜ 
    function bindInputEvents() {
      document.querySelectorAll('.morning-select-type, .morning-input-name, .morning-input-ingredient').forEach(el => {
        el.addEventListener('input', () => {
          updateSimpleInputs('#morning-inputs', 'morning', 'id_morning_items');
        });
      });

      document.querySelectorAll('.night-select-type, .night-input-name, .night-input-ingredient').forEach(el => {
        el.addEventListener('input', () => {
          updateSimpleInputs('#night-inputs', 'night', 'id_night_items');
        });
      });
    }
    
    // âœ… åˆæœŸå‘¼ã³å‡ºã—
    updateListeners();
    renumberItems('#morning-inputs');
    renumberItems('#night-inputs');
    bindInputEvents();

    // âœ… ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ç›´å‰ã«ã‚‚hiddenã‚’æ›´æ–°
    document.querySelector('form').addEventListener('submit', function () {
      updateSimpleInputs('#morning-inputs', 'morning', 'id_morning_items');
      updateSimpleInputs('#night-inputs', 'night', 'id_night_items');

        // ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ï¼ˆå¿…é ˆï¼‰
      console.log("ğŸ’¾ morning_items ä¿å­˜å‰:", document.getElementById('id_morning_items').value);
      console.log("ğŸ’¾ night_items ä¿å­˜å‰:", document.getElementById('id_night_items').value);

      // âœ… æˆåˆ†ï¼ˆæœå¤œï¼‰ã®å…¥åŠ›å€¤ã‚’ã¾ã¨ã‚ã¦ hidden ã«å…¥ã‚Œã‚‹
      const allIngredients = document.querySelectorAll('.morning-input-ingredient, .night-input-ingredient');
      const ingredientList = Array.from(allIngredients)
        .map(i => i.value.trim())
        .filter(Boolean)
        .join(', ');
      document.getElementById('id_ingredients').value = ingredientList;


    });


});

    


</script>
  
  

<p style="text-align:center;"><a href="{% url 'home' %}">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a></p>


{% endblock %}
